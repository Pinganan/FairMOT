import numpy as np
import cv2


class PixelMapper(object):
    """
    Create an object for converting pixels to geographic coordinates,
    using four points with known locations which form a quadrilteral in both planes
    Parameters
    ----------
    pixel_array : (318,2) shape numpy array
        The (x,y) pixel coordinates corresponding to the top left, top right, bottom right, bottom left
        pixels of the known region
    lonlat_array : (350,2) shape numpy array
        The (lon, lat) coordinates corresponding to the top left, top right, bottom right, bottom left
        pixels of the known region
    """
    
    def __init__(self, port):
        assert port == 221 or port == 225, "Need port is 221 or 225"
        quad_coords_221 = {
            "lonlat": np.array([
                [248,69],
                [248,123],
                [248,176],
                [248,227],
                [248,280],
                [248,331],
                [249,384],
                [248,435],
                [248,488],
                [248,542],
                [301,70],
                [301,123],
                [302,176],
                [302,227],
                [301,280],
                [302,332],
                [301,384],
                [301,436],
                [302,488],
                [302,540],
                [301,593],
                [352,70],
                [353,125],
                [353,174],
                [352,225],
                [352,277],
                [353,332],
                [352,385],
                [352,436],
                [353,488],
                [352,540],
                [353,593],
                [353,647],
                [403,70],
                [405,123],
                [405,176],
                [405,227],
                [403,384],
                [403,436],
                [405,542],
                [405,593],
                [403,643],
                [403,698],
                [454,69],
                [456,122],
                [456,174],
                [454,225],
                [454,385],
                [456,436],
                [454,540],
                [454,591],
                [454,646],
                [454,698],
                [456,750],
                [507,174],
                [508,227],
                [507,384],
                [505,435],
                [507,542],
                [505,596],
                [507,647],
                [508,698],
                [508,751],
                [508,802],
                [558,123],
                [560,176],
                [558,227],
                [558,384],
                [560,436],
                [558,542],
                [560,594],
                [560,647],
                [560,698],
                [558,750],
                [560,802],
                [560,858],
                [560,908],
                [611,123],
                [611,176],
                [609,227],
                [611,385],
                [609,436],
                [609,698],
                [609,751],
                [609,804],
                [611,855],
                [609,906],
                [661,122],
                [662,176],
                [662,225],
                [662,385],
                [662,488],
                [662,542],
                [662,594],
                [664,647],
                [661,698],
                [661,751],
                [662,804],
                [662,857],
                [662,906],
                [715,124],
                [716,173],
                [715,228],
                [715,385],
                [713,488],
                [713,541],
                [715,594],
                [713,647],
                [713,698],
                [713,751],
                [715,804],
                [715,854],
                [764,69],
                [764,122],
                [764,175],
                [764,226],
                [766,279],
                [766,332],
                [766,385],
                [766,488],
                [766,543],
                [764,594],
                [766,647],
                [764,697],
                [766,750],
                [766,803],
                [764,854],
                [816,71],
                [816,173],
                [816,228],
                [816,331],
                [816,385],
                [816,437],
                [816,488],
                [817,541],
                [817,594],
                [816,647],
                [817,697],
                [816,751],
                [816,803],
                [816,856],
                [869,173],
                [867,228],
                [867,331],
                [867,384],
                [869,437],
                [867,488],
                [867,539],
                [867,592],
                [867,645],
                [867,698],
                [867,751],
                [869,803],
                [919,175],
                [920,228],
                [919,332],
                [919,384],
                [920,437],
                [919,490],
                [919,541],
                [920,647],
                [919,698],
                [920,751],
                [919,803],
                [972,122],
                [972,228],
                [971,331],
                [971,386],
                [971,437],
                [972,489],
                [971,540],
                [971,592],
                [972,645],
                [972,699],
                [972,749],
                [971,802],
                [1022,124],
                [1022,175],
                [1022,331],
                [1022,383],
                [1024,436],
                [1024,489],
                [1022,540],
                [1024,590],
                [1022,646],
                [1024,699],
                [1022,751],
                [1075,69],
                [1075,124],
                [1074,175],
                [1074,227],
                [1075,333],
                [1074,384],
                [1074,436],
                [1074,489],
                [1074,542],
                [1074,590],
                [1074,645],
                [1074,698],
                [1074,749],
                [1125,71],
                [1125,124],
                [1127,175],
                [1127,228],
                [1127,331],
                [1125,386],
                [1127,436],
                [1127,490],
                [1127,542],
                [1127,593],
                [1125,646],
                [1125,698],
                [1125,749],
                [1178,71],
                [1178,122],
                [1178,175],
                [1178,228],
                [1178,278],
                [1178,331],
                [1178,383],
                [1177,436],
                [1178,489],
                [1178,542],
                [1178,592],
                [1178,645],
                [1175,698],
                [1230,72],
                [1229,123],
                [1229,174],
                [1229,226],
                [1230,279],
                [1229,332],
                [1229,384],
                [1230,437],
                [1230,490],
                [1229,540],
                [1230,593],
                [1230,647],
                [1230,700],
                [1281,69],
                [1281,123],
                [1281,176],
                [1281,227],
                [1281,277],
                [1282,331],
                [1279,384],
                [1282,437],
                [1281,492],
                [1282,542],
                [1281,592],
                [1281,644],
                [1282,697],
                [1334,71],
                [1334,121],
                [1332,174],
                [1332,226],
                [1334,279],
                [1334,331],
                [1334,384],
                [1332,435],
                [1332,489],
                [1332,540],
                [1332,592],
                [1334,645],
                [1332,698],
                [1385,174],
                [1384,227],
                [1384,279],
                [1384,332],
                [1385,385],
                [1385,435],
                [1384,490],
                [1385,540],
                [1385,592],
                [1384,644],
                [1435,176],
                [1435,226],
                [1435,279],
                [1435,331],
                [1435,381],
                [1437,434],
                [1435,592],
                [1435,645],
                [1488,177],
                [1488,226],
                [1488,279],
                [1487,329],
                [1488,384],
                [1490,437],
                [1487,593],
                [1487,645],
                [1540,176],
                [1540,226],
                [1540,382],
                [1540,435],
                [1539,592],
                [1539,645],
                [1590,176],
                [1590,224],
                [1590,384],
                [1590,435],
                [1590,593],
                [1642,226],
                [1642,277],
                [1642,331],
                [1642,382],
                [1642,434],
                [1643,490],
                [1643,542],
                [1642,590],
                [1695,226],
                [1693,279],
                [1693,332],
                [1693,385],
                [1696,435],
                [1696,490],
                [1693,542],
                [1696,592]       
            ]),
            "pixel": np.array([
                [95,617],
                [106,643],
                [117,674],
                [131,709],
                [148,747],
                [165,787],
                [186,836],
                [211,887],
                [241,952],
                [279,1020],
                [167,588],
                [180,614],
                [194,643],
                [216,676],
                [235,714],
                [260,752],
                [289,796],
                [320,847],
                [360,903],
                [405,972],
                [459,1045],
                [239,565],
                [255,589],
                [276,616],
                [300,645],
                [325,678],
                [354,716],
                [391,759],
                [429,803],
                [477,857],
                [531,915],
                [594,987],
                [672,1063],
                [312,538],
                [333,562],
                [357,586],
                [384,614],
                [491,717],
                [539,759],
                [654,860],
                [726,924],
                [812,995],
                [910,1073],
                [385,514],
                [409,535],
                [438,557],
                [471,584],
                [591,677],
                [644,715],
                [773,807],
                [849,860],
                [940,924],
                [1049,995],
                [1166,1071],
                [520,530],
                [553,554],
                [688,639],
                [746,675],
                [883,757],
                [964,803],
                [1059,861],
                [1166,919],
                [1288,983],
                [1417,1052],
                [561,484],
                [598,505],
                [635,527],
                [781,603],
                [843,635],
                [984,708],
                [1069,749],
                [1167,797],
                [1272,849],
                [1388,906],
                [1516,966],
                [1648,1026],
                [1777,1078],
                [634,462],
                [670,479],
                [712,499],
                [867,569],
                [932,598],
                [1363,789],
                [1479,837],
                [1597,888],
                [1723,940],
                [1846,988],
                [702,440],
                [745,457],
                [787,474],
                [950,538],
                [1084,591],
                [1163,623],
                [1247,656],
                [1344,693],
                [1446,733],
                [1556,775],
                [1668,817],
                [1783,864],
                [1896,904],
                [771,418],
                [812,434],
                [857,450],
                [1024,508],
                [1162,556],
                [1241,585],
                [1326,613],
                [1419,648],
                [1516,682],
                [1623,719],
                [1729,758],
                [1835,796],
                [793,383],
                [830,398],
                [878,411],
                [923,428],
                [977,445],
                [1032,461],
                [1095,481],
                [1231,524],
                [1311,551],
                [1394,577],
                [1484,607],
                [1582,638],
                [1677,671],
                [1773,702],
                [1879,739],
                [850,366],
                [941,393],
                [989,407],
                [1099,439],
                [1158,457],
                [1227,473],
                [1296,494],
                [1374,517],
                [1456,542],
                [1541,569],
                [1633,597],
                [1727,629],
                [1822,657],
                [1910,688],
                [1000,373],
                [1048,385],
                [1157,416],
                [1220,430],
                [1285,447],
                [1356,466],
                [1433,489],
                [1511,510],
                [1592,535],
                [1676,558],
                [1768,587],
                [1854,613],
                [1054,355],
                [1102,365],
                [1213,392],
                [1276,407],
                [1339,425],
                [1409,440],
                [1481,460],
                [1638,504],
                [1718,527],
                [1801,552],
                [1885,575],
                [1059,329],
                [1156,349],
                [1265,372],
                [1325,389],
                [1391,405],
                [1455,418],
                [1526,437],
                [1602,455],
                [1679,476],
                [1756,495],
                [1831,519],
                [1910,542],
                [1107,314],
                [1154,321],
                [1313,357],
                [1372,371],
                [1435,384],
                [1500,397],
                [1567,414],
                [1638,433],
                [1713,451],
                [1787,470],
                [1861,491],
                [1109,289],
                [1154,298],
                [1200,307],
                [1249,316],
                [1358,339],
                [1415,352],
                [1480,365],
                [1539,378],
                [1610,395],
                [1677,411],
                [1742,429],
                [1815,447],
                [1883,466],
                [1153,276],
                [1197,286],
                [1246,294],
                [1292,304],
                [1400,325],
                [1456,336],
                [1515,351],
                [1578,362],
                [1640,375],
                [1708,392],
                [1772,409],
                [1839,424],
                [1907,443],
                [1194,266],
                [1238,274],
                [1285,283],
                [1333,290],
                [1383,299],
                [1437,311],
                [1492,320],
                [1550,331],
                [1609,346],
                [1673,358],
                [1734,373],
                [1799,389],
                [1863,404],
                [1233,253],
                [1277,261],
                [1323,270],
                [1371,277],
                [1421,288],
                [1475,297],
                [1530,306],
                [1584,316],
                [1642,331],
                [1702,342],
                [1760,357],
                [1823,370],
                [1882,386],
                [1272,243],
                [1314,250],
                [1360,258],
                [1409,268],
                [1456,273],
                [1508,283],
                [1560,294],
                [1615,305],
                [1672,318],
                [1726,329],
                [1785,342],
                [1841,355],
                [1900,370],
                [1305,234],
                [1347,240],
                [1394,250],
                [1440,257],
                [1487,264],
                [1539,273],
                [1589,282],
                [1642,292],
                [1694,303],
                [1751,315],
                [1806,327],
                [1862,342],
                [1915,354],
                [1427,238],
                [1470,247],
                [1518,253],
                [1567,262],
                [1617,272],
                [1669,281],
                [1721,290],
                [1771,302],
                [1826,316],
                [1879,329],
                [1455,228],
                [1500,236],
                [1546,244],
                [1593,252],
                [1642,260],
                [1690,271],
                [1842,303],
                [1895,315],
                [1484,221],
                [1526,228],
                [1574,235],
                [1620,245],
                [1665,251],
                [1714,262],
                [1859,293],
                [1909,302],
                [1512,213],
                [1551,219],
                [1685,243],
                [1734,252],
                [1874,282],
                [1918,293],
                [1535,204],
                [1577,212],
                [1706,235],
                [1751,245],
                [1887,273],
                [1599,204],
                [1640,211],
                [1681,219],
                [1725,227],
                [1771,236],
                [1812,245],
                [1857,254],
                [1900,264],
                [1620,198],
                [1660,205],
                [1701,212],
                [1743,220],
                [1786,228],
                [1825,237],
                [1872,247],
                [1911,257]
            ])
        }
        
        quad_coords_225 = {
            "lonlat": np.array([
                [1694,1012],
                [1696,960],
                [1694,907],
                [1696,857],
                [1696,803],
                [1694,752],
                [1696,700],
                [1696,648],
                [1696,594],
                [1696,542],
                [1696,490],
                [1642,1013],
                [1644,959],
                [1642,909],
                [1644,859],
                [1642,802],
                [1642,748],
                [1644,702],
                [1644,646],
                [1644,594],
                [1644,544],
                [1642,492],
                [1644,437],
                [1590,1014],
                [1589,961],
                [1590,908],
                [1588,855],
                [1591,802],
                [1590,749],
                [1591,698],
                [1590,645],
                [1591,596],
                [1590,435],
                [1540,906],
                [1540,855],
                [1540,804],
                [1540,751],
                [1538,698],
                [1538,647],
                [1538,592],
                [1538,437],
                [1538,384],
                [1489,908],
                [1489,855],
                [1489,802],
                [1487,751],
                [1489,697],
                [1489,645],
                [1489,594],
                [1487,435],
                [1489,384],
                [1487,333],
                [1436,906],
                [1437,857],
                [1436,805],
                [1436,751],
                [1436,701],
                [1437,647],
                [1436,594],
                [1436,435],
                [1437,386],
                [1436,331],
                [1434,278],
                [1383,908],
                [1381,855],
                [1385,804],
                [1386,753],
                [1385,700],
                [1385,647],
                [1383,594],
                [1385,543],
                [1385,488],
                [1383,437],
                [1385,386],
                [1383,331],
                [1381,280],
                [1385,227],
                [1332,961],
                [1332,906],
                [1332,857],
                [1333,804],
                [1332,751],
                [1333,700],
                [1332,645],
                [1332,591],
                [1332,541],
                [1333,488],
                [1332,439],
                [1332,386],
                [1333,330],
                [1332,278],
                [1332,227],
                [1332,176],
                [1279,1014],
                [1282,959],
                [1281,906],
                [1281,857],
                [1281,802],
                [1281,748],
                [1282,698],
                [1282,644],
                [1281,594],
                [1282,543],
                [1281,488],
                [1281,435],
                [1281,384],
                [1281,331],
                [1281,278],
                [1281,227],
                [1282,176],
                [1229,1012],
                [1229,960],
                [1229,907],
                [1231,854],
                [1231,803],
                [1231,751],
                [1231,696],
                [1229,647],
                [1229,595],
                [1231,542],
                [1229,490],
                [1229,437],
                [1231,383],
                [1229,333],
                [1231,281],
                [1229,226],
                [1231,173],
                [1178,1012],
                [1179,960],
                [1179,907],
                [1179,856],
                [1179,803],
                [1178,751],
                [1179,700],
                [1179,648],
                [1178,590],
                [1179,540],
                [1179,489],
                [1178,437],
                [1179,384],
                [1178,333],
                [1181,278],
                [1178,226],
                [1128,907],
                [1126,856],
                [1124,804],
                [1128,751],
                [1126,700],
                [1128,645],
                [1126,592],
                [1126,540],
                [1126,489],
                [1126,437],
                [1128,384],
                [1126,333],
                [1126,226],
                [1076,907],
                [1076,854],
                [1075,803],
                [1075,750],
                [1076,700],
                [1075,645],
                [1076,593],
                [1076,540],
                [1076,490],
                [1076,439],
                [1076,384],
                [1076,333],
                [1025,906],
                [1023,851],
                [1025,804],
                [1025,750],
                [1025,696],
                [1025,647],
                [1025,593],
                [1023,539],
                [1021,490],
                [1025,436],
                [1023,384],
                [1023,333],
                [971,905],
                [971,856],
                [972,805],
                [971,748],
                [971,698],
                [969,645],
                [971,593],
                [972,543],
                [971,489],
                [972,436],
                [971,384],
                [972,333],
                [917,960],
                [919,907],
                [919,855],
                [921,801],
                [921,750],
                [919,698],
                [919,645],
                [921,539],
                [921,489],
                [919,433],
                [919,386],
                [921,333],
                [869,1013],
                [869,960],
                [867,907],
                [869,856],
                [869,801],
                [866,751],
                [869,698],
                [867,646],
                [869,593],
                [869,541],
                [869,488],
                [867,436],
                [869,384],
                [867,331],
                [816,960],
                [816,908],
                [816,856],
                [814,805],
                [817,751],
                [817,698],
                [816,645],
                [817,594],
                [816,543],
                [817,491],
                [817,438],
                [817,386],
                [817,331],
                [764,961],
                [764,907],
                [766,856],
                [762,800],
                [764,750],
                [764,700],
                [762,646],
                [764,596],
                [766,544],
                [762,488],
                [766,386],
                [766,333],
                [711,959],
                [711,906],
                [714,854],
                [714,803],
                [714,750],
                [712,696],
                [712,645],
                [714,595],
                [714,540],
                [714,490],
                [714,386],
                [661,960],
                [663,907],
                [661,856],
                [663,803],
                [663,751],
                [661,698],
                [661,645],
                [663,592],
                [661,542],
                [661,490],
                [663,386],
                [609,1014],
                [611,960],
                [611,907],
                [611,854],
                [609,804],
                [611,751],
                [611,698],
                [611,437],
                [611,384],
                [560,1014],
                [558,960],
                [560,907],
                [558,853],
                [558,804],
                [560,750],
                [560,700],
                [560,647],
                [560,593],
                [558,542],
                [558,437],
                [506,1014],
                [508,960],
                [506,907],
                [506,856],
                [508,804],
                [506,751],
                [508,698],
                [508,647],
                [506,592],
                [508,540],
                [508,436],
                [457,1012],
                [455,957],
                [457,907],
                [457,851],
                [455,803],
                [455,750],
                [455,696],
                [455,643],
                [457,593],
                [457,542],
                [455,436],
                [405,1012],
                [405,960],
                [403,907],
                [403,854],
                [403,804],
                [403,748],
                [405,700],
                [405,645],
                [405,593],
                [405,542],
                [352,1014],
                [350,959],
                [354,909],
                [354,856],
                [352,803],
                [354,751],
                [352,700],
                [354,645],
                [352,595],
                [354,540],
                [354,489],
                [300,1010],
                [300,957],
                [302,907],
                [302,854],
                [302,803],
                [302,750],
                [300,698],
                [302,648],
                [300,593],
                [302,542],
                [300,489],
                [247,1012],
                [247,956],
                [249,906],
                [249,853],
                [247,804],
                [249,753],
                [249,698],
                [249,645],
                [247,590],
                [249,539],
                [249,489]       
            ]),
            "pixel": np.array([
                [60,471],
                [69,498],
                [79,528],
                [89,561],
                [101,603],
                [119,648],
                [137,696],
                [160,753],
                [189,820],
                [219,897],
                [266,995],
                [137,451],
                [148,477],
                [162,508],
                [178,541],
                [195,576],
                [219,621],
                [245,667],
                [275,722],
                [316,787],
                [358,858],
                [415,946],
                [478,1040],
                [213,431],
                [228,455],
                [246,486],
                [267,515],
                [292,550],
                [322,590],
                [357,638],
                [394,685],
                [440,748],
                [636,983],
                [332,464],
                [357,494],
                [388,526],
                [422,561],
                [461,606],
                [507,653],
                [566,710],
                [788,926],
                [888,1019],
                [415,443],
                [445,471],
                [483,502],
                [525,538],
                [570,576],
                [626,621],
                [683,673],
                [922,867],
                [1024,949],
                [1146,1039],
                [501,424],
                [534,451],
                [573,481],
                [616,514],
                [668,554],
                [725,593],
                [795,641],
                [1043,814],
                [1153,887],
                [1272,964],
                [1405,1050],
                [580,406],
                [620,431],
                [662,461],
                [710,492],
                [766,525],
                [829,565],
                [894,607],
                [968,657],
                [1059,708],
                [1152,763],
                [1263,832],
                [1375,896],
                [1502,978],
                [1633,1049],
                [620,371],
                [656,390],
                [694,414],
                [744,440],
                [796,473],
                [852,503],
                [919,538],
                [987,576],
                [1069,619],
                [1157,672],
                [1253,720],
                [1359,781],
                [1469,839],
                [1587,907],
                [1706,970],
                [1828,1034],
                [653,338],
                [690,358],
                [731,379],
                [773,400],
                [826,422],
                [879,452],
                [938,484],
                [1005,517],
                [1075,553],
                [1153,591],
                [1241,636],
                [1332,681],
                [1437,732],
                [1547,787],
                [1653,843],
                [1772,902],
                [1880,965],
                [723,326],
                [757,344],
                [798,364],
                [845,383],
                [897,407],
                [955,433],
                [1017,462],
                [1082,494],
                [1155,526],
                [1230,565],
                [1318,605],
                [1408,646],
                [1510,694],
                [1607,742],
                [1716,793],
                [1823,846],
                [1918,897],
                [783,312],
                [826,329],
                [870,349],
                [916,369],
                [971,391],
                [1025,417],
                [1087,442],
                [1153,472],
                [1226,502],
                [1303,541],
                [1384,576],
                [1477,613],
                [1568,657],
                [1666,704],
                [1762,748],
                [1861,796],
                [936,340],
                [984,358],
                [1035,379],
                [1091,401],
                [1152,429],
                [1221,456],
                [1292,482],
                [1365,514],
                [1447,554],
                [1533,585],
                [1622,626],
                [1712,663],
                [1898,755],
                [993,326],
                [1045,345],
                [1096,367],
                [1152,386],
                [1214,410],
                [1281,437],
                [1349,463],
                [1422,495],
                [1503,528],
                [1582,559],
                [1668,595],
                [1760,633],
                [1051,316],
                [1098,334],
                [1151,353],
                [1210,374],
                [1268,395],
                [1337,421],
                [1406,443],
                [1472,472],
                [1555,504],
                [1627,535],
                [1707,570],
                [1797,605],
                [1105,307],
                [1152,322],
                [1205,340],
                [1262,362],
                [1322,385],
                [1385,407],
                [1451,431],
                [1523,455],
                [1595,487],
                [1670,513],
                [1746,548],
                [1826,581],
                [1105,281],
                [1154,298],
                [1200,313],
                [1253,333],
                [1311,352],
                [1371,371],
                [1430,394],
                [1566,440],
                [1634,469],
                [1705,497],
                [1777,525],
                [1853,557],
                [1107,260],
                [1153,276],
                [1199,290],
                [1248,307],
                [1302,326],
                [1356,340],
                [1415,363],
                [1473,380],
                [1536,404],
                [1601,427],
                [1673,455],
                [1741,478],
                [1807,508],
                [1880,536],
                [1195,269],
                [1244,283],
                [1291,300],
                [1344,316],
                [1397,332],
                [1456,352],
                [1515,371],
                [1577,393],
                [1639,414],
                [1705,438],
                [1767,462],
                [1833,491],
                [1901,517],
                [1239,262],
                [1287,276],
                [1332,290],
                [1382,307],
                [1436,322],
                [1492,340],
                [1551,360],
                [1611,381],
                [1669,401],
                [1731,426],
                [1855,472],
                [1917,500],
                [1280,255],
                [1325,267],
                [1371,282],
                [1422,301],
                [1475,317],
                [1526,332],
                [1581,350],
                [1642,373],
                [1696,391],
                [1760,415],
                [1876,460],
                [1317,250],
                [1360,264],
                [1407,278],
                [1456,291],
                [1508,311],
                [1557,328],
                [1614,343],
                [1670,362],
                [1722,379],
                [1782,404],
                [1898,446],
                [1309,235],
                [1350,246],
                [1396,260],
                [1442,275],
                [1488,288],
                [1540,302],
                [1592,318],
                [1857,414],
                [1913,433],
                [1342,230],
                [1381,240],
                [1427,255],
                [1472,267],
                [1519,280],
                [1567,296],
                [1616,311],
                [1669,328],
                [1720,348],
                [1772,365],
                [1876,405],
                [1373,225],
                [1417,236],
                [1457,250],
                [1502,261],
                [1547,276],
                [1592,288],
                [1642,305],
                [1690,319],
                [1742,338],
                [1792,355],
                [1893,395],
                [1404,220],
                [1444,233],
                [1487,245],
                [1530,257],
                [1572,271],
                [1617,285],
                [1666,300],
                [1716,313],
                [1763,331],
                [1810,349],
                [1906,385],
                [1431,217],
                [1469,228],
                [1512,241],
                [1554,253],
                [1598,266],
                [1642,280],
                [1686,294],
                [1733,307],
                [1780,325],
                [1826,340],
                [1460,212],
                [1497,224],
                [1539,237],
                [1577,250],
                [1621,263],
                [1667,276],
                [1709,289],
                [1753,305],
                [1798,320],
                [1842,335],
                [1888,353],
                [1486,212],
                [1523,222],
                [1561,234],
                [1602,245],
                [1645,258],
                [1686,272],
                [1727,284],
                [1770,298],
                [1815,315],
                [1861,331],
                [1900,344],
                [1507,209],
                [1547,220],
                [1584,229],
                [1624,242],
                [1663,253],
                [1702,266],
                [1745,281],
                [1787,294],
                [1831,310],
                [1873,324],
                [1915,341]
            ])
        }
        quad_coords = {221: quad_coords_221, 225: quad_coords_225}
        pixel_array = quad_coords[port]['pixel']
        lonlat_array = quad_coords[port]['lonlat']
        # print("\n")
        # print("getPerspectiveTransform: \n",cv2.getPerspectiveTransform(np.float32(pixel_array),np.float32(lonlat_array)))
        # print("findHomography: ",cv2.findHomography(np.float32(pixel_array),np.float32(lonlat_array)))
        self.M, mask1 = cv2.findHomography(np.float32(pixel_array),np.float32(lonlat_array))
        # print("\n")
        # print(self.M)
        # print("\n")
        self.invM, mask2 = cv2.findHomography(np.float32(lonlat_array),np.float32(pixel_array))
        
    def pixel_to_lonlat(self, pixel):
        """
        Convert a set of pixel coordinates to lon-lat coordinates
        Parameters
        ----------
        pixel : (N,2) numpy array or (x,y) tuple
            The (x,y) pixel coordinates to be converted
        Returns
        -------
        (N,2) numpy array
            The corresponding (lon, lat) coordinates
        """
        if type(pixel) != np.ndarray:
            pixel = np.array(pixel).reshape(1,2)
        assert pixel.shape[1]==2, "Need (N,2) input array" 
        #print("or_pixel: \n",pixel)
        pixel = np.concatenate([pixel, np.ones((pixel.shape[0],1))], axis=1)
        #print("pixel: \n",pixel)
        lonlat = np.dot(self.M,pixel.T)
        #print("lonlat: \n",lonlat)
        #print("new_lonlat: \n",lonlat[:2,:])
        #print("new_lonlat: \n",lonlat[2,:])
        #print("new_lonlat: \n",lonlat[:2,:]/lonlat[2,:])
        #print("new_lonlat: \n",(lonlat[:2,:]/lonlat[2,:]).T)
        return (lonlat[:2,:]/lonlat[2,:]).T
    
    def lonlat_to_pixel(self, lonlat):
        """
        Convert a set of lon-lat coordinates to pixel coordinates
        Parameters
        ----------
        lonlat : (N,2) numpy array or (x,y) tuple
            The (lon,lat) coordinates to be converted
        Returns
        -------
        (N,2) numpy array
            The corresponding (x, y) pixel coordinates
        """
        if type(lonlat) != np.ndarray:
            lonlat = np.array(lonlat).reshape(1,2)
        assert lonlat.shape[1]==2, "Need (N,2) input array" 
        lonlat = np.concatenate([lonlat, np.ones((lonlat.shape[0],1))], axis=1)
        pixel = np.dot(self.invM,lonlat.T)
        
        return (pixel[:2,:]/pixel[2,:]).T
